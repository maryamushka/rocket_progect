<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß© –°–æ–±–µ—Ä–∏ —Ä–∞–∫–µ—Ç—É</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            color: #ffff00;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .game-instructions {
            color: #aaa;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 20px;
            line-height: 1.5;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        @media (min-width: 768px) {
            .game-area {
                flex-direction: row;
            }
        }

        .parts-section {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #00ffff;
        }

        .rocket-section {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #ff00ff;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .section-title {
            color: #00ffff;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .parts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .part-item {
            background: linear-gradient(135deg, #3a3a7a, #4a4a9a);
            border: 3px dashed #ffff00;
            border-radius: 15px;
            padding: 20px;
            cursor: grab;
            user-select: none;
            transition: all 0.3s;
            text-align: center;
        }

        .part-item:hover {
            transform: scale(1.05);
            border-color: #00ffff;
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        .part-emoji {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .part-name {
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .rocket-silhouette {
            width: 200px;
            height: 400px;
            background: linear-gradient(180deg, #666666, #333333);
            border-radius: 100px 100px 20px 20px;
            position: relative;
            margin: 20px 0;
            border: 4px solid #00ffaa;
            box-shadow: 0 0 20px rgba(0, 255, 170, 0.3);
        }

        .drop-zone {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed #ffff00;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .drop-zone.hover {
            background: rgba(0, 255, 170, 0.2);
            border-color: #00ffaa;
        }

        .drop-zone.filled {
            background: rgba(0, 255, 0, 0.3);
            border-color: #00ff00;
            color: white;
        }

        .drop-zone.top {
            top: 40px;
            left: 50px;
            right: 50px;
            height: 80px;
        }

        .drop-zone.middle {
            top: 140px;
            left: 60px;
            right: 60px;
            height: 100px;
        }

        .drop-zone.bottom {
            bottom: 60px;
            left: 70px;
            right: 70px;
            height: 120px;
        }

        .drop-zone.engine {
            bottom: 20px;
            left: 85px;
            right: 85px;
            height: 40px;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-btn:hover {
            transform: translateY(-5px);
        }

        .check-btn {
            background: linear-gradient(45deg, #00ff00, #00aa00);
            color: white;
        }

        .reset-btn {
            background: linear-gradient(45deg, #ff4444, #aa0000);
            color: white;
        }

        .back-btn {
            background: linear-gradient(45deg, #4444ff, #0000aa);
            color: white;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            color: #aaa;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            color: #ffff00;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .completion-message {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 15px;
            display: none;
        }

        .completion-message.success {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
        }

        .completion-message.error {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            color: #ff0000;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 25px;
            background: linear-gradient(45deg, #ff0066, #ff5500);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .star-reward {
            color: gold;
            font-size: 1.2rem;
            text-align: center;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="kid-mode">
    <div class="starfield"></div>

    <button class="back-button" onclick="window.location.href='/games'">
        <i class="fas fa-arrow-left"></i> –ö –∏–≥—Ä–∞–º
    </button>

    <div class="container">
        <div class="game-container">
            <div class="game-header">
                <h1 class="game-title">üß© –°–û–ë–ï–†–ò –†–ê–ö–ï–¢–£</h1>
                <p class="game-instructions">
                    –ü–µ—Ä–µ—Ç–∞—â–∏ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∫–µ—Ç—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞! –ö–∞–∂–¥–∞—è –¥–µ—Ç–∞–ª—å –¥–æ–ª–∂–Ω–∞ –æ–∫–∞–∑–∞—Ç—å—Å—è –≤ —Å–≤–æ–µ–π –∑–æ–Ω–µ.
                    –°–æ–±–µ—Ä–∏ —Ä–∞–∫–µ—Ç—É –ø–æ–ª–Ω–æ—Å—Ç—å—é, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–≤—ë–∑–¥—ã!
                </p>
            </div>

            <div class="game-area">
                <!-- –ß–∞—Å—Ç–∏ —Ä–∞–∫–µ—Ç—ã –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è -->
                <div class="parts-section">
                    <h2 class="section-title">üì¶ –î–µ—Ç–∞–ª–∏ —Ä–∞–∫–µ—Ç—ã</h2>
                    <div class="parts-grid" id="parts-container">
                        <!-- –î–µ—Ç–∞–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>

                <!-- –°—Ö–µ–º–∞ —Ä–∞–∫–µ—Ç—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ -->
                <div class="rocket-section">
                    <h2 class="section-title">üöÄ –°–æ–±–µ—Ä–∏ —Ä–∞–∫–µ—Ç—É –∑–¥–µ—Å—å</h2>
                    <div class="rocket-silhouette" id="rocket-silhouette">
                        <!-- –ó–æ–Ω—ã –¥–ª—è —Å–±—Ä–æ—Å–∞ –¥–µ—Ç–∞–ª–µ–π -->
                        <div class="drop-zone top" data-zone="top" data-part="nose">
                            <span class="zone-label">üëÉ –ù–æ—Å —Ä–∞–∫–µ—Ç—ã</span>
                        </div>
                        <div class="drop-zone middle" data-zone="middle" data-part="body">
                            <span class="zone-label">üöÄ –ö–æ—Ä–ø—É—Å</span>
                        </div>
                        <div class="drop-zone bottom" data-zone="bottom" data-part="tank">
                            <span class="zone-label">‚õΩ –¢–æ–ø–ª–∏–≤–Ω—ã–π –±–∞–∫</span>
                        </div>
                        <div class="drop-zone engine" data-zone="engine" data-part="engine">
                            <span class="zone-label">üî• –î–≤–∏–≥–∞—Ç–µ–ª—å</span>
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="game-stats">
                        <div class="stat-item">
                            <div>–°–æ–±—Ä–∞–Ω–æ:</div>
                            <div class="stat-value" id="parts-collected">0</div>
                            <div>–∏–∑ 4</div>
                        </div>
                        <div class="stat-item">
                            <div>–ü–æ–ø—ã—Ç–∫–∏:</div>
                            <div class="stat-value" id="attempts-count">0</div>
                        </div>
                    </div>

                    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ -->
                    <div class="completion-message" id="completion-message">
                        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å -->
                    </div>

                    <!-- –ó–≤—ë–∑–¥—ã –∑–∞ –ø–æ–±–µ–¥—É -->
                    <div class="star-reward" id="star-reward">
                        ‚≠ê –ó–∞ –ø–æ–±–µ–¥—É –ø–æ–ª—É—á–∏—à—å +5 –∑–≤—ë–∑–¥!
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="game-controls">
                <button class="control-btn check-btn" onclick="checkRocket()">
                    <i class="fas fa-check-circle"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É
                </button>
                <button class="control-btn reset-btn" onclick="resetGame()">
                    <i class="fas fa-redo"></i> –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
                </button>
                <button class="control-btn back-btn" onclick="window.location.href='/games'">
                    <i class="fas fa-gamepad"></i> –î—Ä—É–≥–∏–µ –∏–≥—Ä—ã
                </button>
            </div>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let collectedParts = 0;
        let totalParts = 4;
        let attempts = 0;
        let gameCompleted = false;
        let draggedPart = null;

        // –î–µ—Ç–∞–ª–∏ —Ä–∞–∫–µ—Ç—ã
        const rocketParts = [
            { id: 'nose', name: '–ù–æ—Å —Ä–∞–∫–µ—Ç—ã', emoji: 'üëÉ', correctZone: 'top', description: '–ê—ç—Ä–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –Ω–æ—Å–æ–≤–æ–π –æ–±—Ç–µ–∫–∞—Ç–µ–ª—å' },
            { id: 'body', name: '–ö–æ—Ä–ø—É—Å', emoji: 'üöÄ', correctZone: 'middle', description: '–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–ø—É—Å —Å –∫–∞–±–∏–Ω–æ–π –∫–æ—Å–º–æ–Ω–∞–≤—Ç–æ–≤' },
            { id: 'tank', name: '–¢–æ–ø–ª–∏–≤–Ω—ã–π –±–∞–∫', emoji: '‚õΩ', correctZone: 'bottom', description: '–•—Ä–∞–Ω–∏—Ç —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –ø–æ–ª—ë—Ç–∞' },
            { id: 'engine', name: '–î–≤–∏–≥–∞—Ç–µ–ª—å', emoji: 'üî•', correctZone: 'engine', description: '–ú–æ—â–Ω—ã–π —Ä–∞–∫–µ—Ç–Ω—ã–π –¥–≤–∏–≥–∞—Ç–µ–ª—å' }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã "–°–æ–±–µ—Ä–∏ —Ä–∞–∫–µ—Ç—É"');

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –¥–µ—Ç–∞–ª—è–º–∏
            const partsContainer = document.getElementById('parts-container');
            partsContainer.innerHTML = '';

            rocketParts.forEach(part => {
                const partElement = document.createElement('div');
                partElement.className = 'part-item';
                partElement.id = `part-${part.id}`;
                partElement.draggable = true;
                partElement.dataset.partId = part.id;

                partElement.innerHTML = `
                    <div class="part-emoji">${part.emoji}</div>
                    <div class="part-name">${part.name}</div>
                `;

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                partElement.addEventListener('dragstart', handleDragStart);
                partElement.addEventListener('dragend', handleDragEnd);

                partsContainer.appendChild(partElement);
            });

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∑–æ–Ω —Å–±—Ä–æ—Å–∞
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragenter', handleDragEnter);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });

            // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–Ω–æ–µ –ø–æ–ª–µ
            createStarfield();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();

            console.log('–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
        function handleDragStart(e) {
            if (gameCompleted) return;

            draggedPart = e.target;
            e.dataTransfer.setData('text/plain', e.target.dataset.partId);
            e.target.style.opacity = '0.5';

            console.log('–ù–∞—á–∞–ª–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ:', e.target.dataset.partId);
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
            draggedPart = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            if (gameCompleted) return;

            e.preventDefault();
            const zone = e.target.closest('.drop-zone');
            if (zone && !zone.classList.contains('filled')) {
                zone.classList.add('hover');
            }
        }

        function handleDragLeave(e) {
            const zone = e.target.closest('.drop-zone');
            if (zone) {
                zone.classList.remove('hover');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            if (gameCompleted) return;

            const zone = e.target.closest('.drop-zone');
            if (!zone || zone.classList.contains('filled')) return;

            const partId = e.dataTransfer.getData('text/plain');
            const part = rocketParts.find(p => p.id === partId);

            if (!part) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–∏ –∑–æ–Ω–∞
            const isCorrect = zone.dataset.part === partId;

            if (isCorrect) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–æ–Ω–∞
                zone.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 2rem;">${part.emoji}</div>
                        <div style="color: #00ff00; font-size: 0.9rem;">${part.name}</div>
                        <div style="color: #aaa; font-size: 0.8rem;">‚úÖ –í–µ—Ä–Ω–æ!</div>
                    </div>
                `;
                zone.classList.add('filled');
                zone.classList.remove('hover');

                // –°–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—É—é –¥–µ—Ç–∞–ª—å
                const partElement = document.getElementById(`part-${partId}`);
                partElement.style.display = 'none';

                collectedParts++;
                updateStats();

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —É—Å–ø–µ—Ö–∞
                playSound('success');
                showNotification(`‚úÖ –û—Ç–ª–∏—á–Ω–æ! ${part.name} –Ω–∞ –º–µ—Å—Ç–µ!`);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–±—Ä–∞–Ω–∞ –ª–∏ –≤—Å—è —Ä–∞–∫–µ—Ç–∞
                if (collectedParts === totalParts) {
                    setTimeout(() => {
                        completeGame();
                    }, 500);
                }
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–æ–Ω–∞
                zone.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 2rem;">‚ùå</div>
                        <div style="color: #ff0000; font-size: 0.9rem;">–ù–µ —Å—é–¥–∞!</div>
                    </div>
                `;

                // –ß–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–æ–Ω—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                setTimeout(() => {
                    zone.innerHTML = `<span class="zone-label">${zone.querySelector('.zone-label')?.textContent || '–ü–µ—Ä–µ—Ç–∞—â–∏ —Å—é–¥–∞'}</span>`;
                    zone.classList.remove('hover');
                }, 1000);

                attempts++;
                updateStats();

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –æ—à–∏–±–∫–∏
                playSound('error');
                showNotification(`‚ùå ${part.name} –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã!`);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏
        function checkRocket() {
            if (gameCompleted) {
                showNotification('üéâ –†–∞–∫–µ—Ç–∞ —É–∂–µ —Å–æ–±—Ä–∞–Ω–∞! –•–æ—á–µ—à—å —Å–æ–±—Ä–∞—Ç—å –µ—â–µ —Ä–∞–∑?');
                return;
            }

            attempts++;
            updateStats();

            if (collectedParts === totalParts) {
                completeGame();
            } else {
                const message = document.getElementById('completion-message');
                message.textContent = `–°–æ–±—Ä–∞–Ω–æ ${collectedParts} –∏–∑ ${totalParts} –¥–µ—Ç–∞–ª–µ–π. –ü—Ä–æ–¥–æ–ª–∂–∞–π —Å–æ–±–∏—Ä–∞—Ç—å!`;
                message.className = 'completion-message error';
                message.style.display = 'block';

                playSound('error');

                // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    message.style.display = 'none';
                }, 3000);
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        async function completeGame() {
            gameCompleted = true;

            const message = document.getElementById('completion-message');
            message.innerHTML = `
                üéâ –£–†–ê! –†–ê–ö–ï–¢–ê –°–û–ë–†–ê–ù–ê!<br>
                <small>–¢—ã —Å–æ–±—Ä–∞–ª —Ä–∞–∫–µ—Ç—É –∑–∞ ${attempts} –ø–æ–ø—ã—Ç–æ–∫!</small>
            `;
            message.className = 'completion-message success';
            message.style.display = 'block';

            // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∫–µ—Ç—ã
            const rocket = document.getElementById('rocket-silhouette');
            rocket.style.animation = 'rocketLaunch 2s forwards';

            // –ù–∞—á–∏—Å–ª—è–µ–º –∑–≤—ë–∑–¥—ã
            const starsEarned = calculateStars();
            try {
                const response = await fetch('/add_star', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        count: starsEarned,
                        reason: '–°–æ–±—Ä–∞–ª —Ä–∞–∫–µ—Ç—É –≤ –∏–≥—Ä–µ'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showNotification(`‚≠ê –ü–æ–ª—É—á–µ–Ω–æ ${starsEarned} –∑–≤—ë–∑–¥! –í—Å–µ–≥–æ: ${data.stars}`);
                    document.getElementById('star-reward').innerHTML = `‚≠ê –í—ã –ø–æ–ª—É—á–∏–ª–∏ +${starsEarned} –∑–≤—ë–∑–¥!`;
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–≤—ë–∑–¥:', error);
                showNotification('üéâ –†–∞–∫–µ—Ç–∞ —Å–æ–±—Ä–∞–Ω–∞!');
            }

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø–æ–±–µ–¥—ã
            playSound('star');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ
            updateUserProfile();
        }

        // –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–≤—ë–∑–¥
        function calculateStars() {
            let stars = 5; // –ë–∞–∑–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

            // –ë–æ–Ω—É—Å –∑–∞ –º–∞–ª–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
            if (attempts <= 4) stars += 2;
            else if (attempts <= 6) stars += 1;

            return stars;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function updateUserProfile() {
            try {
                await fetch('/update_profile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        games_played: 'increment',
                        builds_completed: 'increment'
                    })
                });
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
        }

        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            collectedParts = 0;
            attempts = 0;
            gameCompleted = false;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–æ–Ω—ã
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.innerHTML = `<span class="zone-label">${zone.dataset.part === 'nose' ? 'üëÉ –ù–æ—Å —Ä–∞–∫–µ—Ç—ã' :
                                                    zone.dataset.part === 'body' ? 'üöÄ –ö–æ—Ä–ø—É—Å' :
                                                    zone.dataset.part === 'tank' ? '‚õΩ –¢–æ–ø–ª–∏–≤–Ω—ã–π –±–∞–∫' :
                                                    'üî• –î–≤–∏–≥–∞—Ç–µ–ª—å'}</span>`;
                zone.classList.remove('filled', 'hover');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–µ—Ç–∞–ª–∏
            rocketParts.forEach(part => {
                const partElement = document.getElementById(`part-${part.id}`);
                if (partElement) {
                    partElement.style.display = 'block';
                }
            });

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ä–∞–∫–µ—Ç—ã
            const rocket = document.getElementById('rocket-silhouette');
            rocket.style.animation = '';

            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const message = document.getElementById('completion-message');
            message.style.display = 'none';

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
            document.getElementById('star-reward').innerHTML = '‚≠ê –ó–∞ –ø–æ–±–µ–¥—É –ø–æ–ª—É—á–∏—à—å +5 –∑–≤—ë–∑–¥!';

            updateStats();

            showNotification('üîÑ –ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞! –ù–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ!');
            playSound('click');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('parts-collected').textContent = collectedParts;
            document.getElementById('attempts-count').textContent = attempts;
        }

        // –ó–≤—É–∫–∏
        function playSound(type) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—ã–ª–∏ –±—ã –∑–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã
            console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞:', type);
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 15px 25px;
                border-radius: 15px;
                border-left: 5px solid gold;
                max-width: 300px;
                z-index: 10000;
                animation: slideIn 0.3s;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤–µ–∑–¥–Ω–æ–≥–æ –ø–æ–ª—è
        function createStarfield() {
            const starfield = document.querySelector('.starfield');
            starfield.innerHTML = '';

            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 3 + 1}px;
                    height: ${Math.random() * 3 + 1}px;
                    background: white;
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: twinkle ${Math.random() * 3 + 2}s infinite;
                    animation-delay: ${Math.random() * 3}s;
                `;
                starfield.appendChild(star);
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        function addGameStyles() {
            if (!document.getElementById('game-styles')) {
                const style = document.createElement('style');
                style.id = 'game-styles';
                style.textContent = `
                    @keyframes rocketLaunch {
                        0% {
                            transform: translateY(0) rotate(0deg);
                            opacity: 1;
                        }
                        50% {
                            transform: translateY(-50px) rotate(5deg);
                            opacity: 0.8;
                        }
                        100% {
                            transform: translateY(-100px) rotate(10deg);
                            opacity: 0;
                        }
                    }

                    @keyframes slideIn {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }

                    @keyframes pulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.7; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä—ã "–°–æ–±–µ—Ä–∏ —Ä–∞–∫–µ—Ç—É" –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            addGameStyles();
            initGame();
        });
    </script>

</body>
</html>