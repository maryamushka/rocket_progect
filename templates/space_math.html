<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¢ –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Å—á—ë—Ç</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .math-container {
            max-width: 800px;
            margin: 30px auto;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 30px;
            border: 3px solid #ff00ff;
            text-align: center;
        }

        .math-title {
            font-size: 2.5rem;
            color: #00ffff;
            margin-bottom: 30px;
        }

        .rocket-area {
            position: relative;
            width: 100%;
            height: 300px;
            margin: 30px 0;
            background: linear-gradient(0deg, #0a0a2a, #1a1a4a);
            border-radius: 20px;
            overflow: hidden;
            border: 3px solid #00ffaa;
        }

        .rocket {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            transition: bottom 0.5s;
        }

        .fuel-bar {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #00ffff;
        }

        .fuel-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff5500, #ffff00);
            width: 0%;
            transition: width 0.5s;
        }

        .problem-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid #ffff00;
        }

        .problem {
            font-size: 3rem;
            color: white;
            margin: 20px 0;
        }

        .answer-input {
            font-size: 2.5rem;
            padding: 15px;
            width: 200px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #00ffff;
            border-radius: 15px;
            color: white;
            margin: 20px;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .answer-btn {
            padding: 20px;
            font-size: 2rem;
            background: linear-gradient(45deg, #2a2a5a, #3a3a7a);
            border: 2px solid #00ffff;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .answer-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, #00ffff, #ff00ff);
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 20px 0;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            color: gold;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .control-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
        }
    </style>
</head>
<body class="kid-mode">
    <div class="starfield"></div>

    <button class="back-button" onclick="window.location.href='/games'" style="position: fixed; top: 20px; left: 20px; padding: 15px 25px; background: linear-gradient(45deg, #ff0066, #ff5500); color: white; border: none; border-radius: 20px; font-size: 1.2rem; cursor: pointer; z-index: 1000; display: flex; align-items: center; gap: 10px;">
        ‚Üê –ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º
    </button>

    <div class="math-container">
        <h1 class="math-title">üî¢ –ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –°–ß–Å–¢</h1>

        <div class="rocket-area">
            <div class="rocket" id="rocket">üöÄ</div>
            <div class="fuel-bar">
                <div class="fuel-fill" id="fuel-fill"></div>
            </div>
            <div style="position: absolute; top: 20px; left: 20px; color: #ffff00; font-size: 1.2rem;">
                –¶–µ–ª—å: –î–æ–ª–µ—Ç–µ—Ç—å –¥–æ –õ—É–Ω—ã! üåô
            </div>
        </div>

        <div class="game-stats">
            <div class="stat">
                <div>–£—Ä–æ–≤–µ–Ω—å</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat">
                <div>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                <div class="stat-value" id="correct">0</div>
            </div>
            <div class="stat">
                <div>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                <div class="stat-value" id="wrong">0</div>
            </div>
            <div class="stat">
                <div>–¢–æ–ø–ª–∏–≤–æ</div>
                <div class="stat-value" id="fuel">100%</div>
            </div>
        </div>

        <div class="problem-display">
            <div style="color: #00ffaa; font-size: 1.5rem; margin-bottom: 10px;">
                –†–µ—à–∏ –ø—Ä–∏–º–µ—Ä —á—Ç–æ–±—ã –∑–∞–ø—Ä–∞–≤–∏—Ç—å —Ä–∞–∫–µ—Ç—É:
            </div>
            <div class="problem" id="problem">5 + 3 = ?</div>

            <div class="answers-grid" id="answers">
                <!-- –û—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>

            <div style="margin-top: 20px;">
                <input type="number" class="answer-input" id="answer-input" placeholder="–û—Ç–≤–µ—Ç">
                <button onclick="checkAnswerInput()" style="padding: 15px 30px; background: linear-gradient(45deg, #00aa00, #00ff88); color: white; border: none; border-radius: 15px; font-size: 1.2rem; cursor: pointer; margin-left: 15px;">
                    ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                </button>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="generateProblem()">üî¢ –ù–û–í–´–ô –ü–†–ò–ú–ï–†</button>
            <button class="control-btn" onclick="resetGame()">üîÑ –ó–ê–ù–û–í–û</button>
            <button class="control-btn" onclick="window.location.href='/games'">üè† –í–´–ô–¢–ò</button>
        </div>
    </div>

    <script>
        let level = 1;
        let correct = 0;
        let wrong = 0;
        let fuel = 100;
        let currentAnswer = 0;
        let rocketPosition = 50;
        let problemsSolved = 0;

        function generateProblem() {
            let a, b, operator, answer;

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å —É—Ä–æ–≤–Ω–µ–º
            const maxNumber = 5 + level * 5;

            // –í—ã–±–∏—Ä–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é
            const operations = ['+', '-', '√ó', '√∑'];
            const operation = operations[Math.floor(Math.random() * operations.length)];

            switch(operation) {
                case '+':
                    a = Math.floor(Math.random() * maxNumber) + 1;
                    b = Math.floor(Math.random() * maxNumber) + 1;
                    answer = a + b;
                    break;
                case '-':
                    a = Math.floor(Math.random() * maxNumber) + 1;
                    b = Math.floor(Math.random() * a) + 1;
                    answer = a - b;
                    break;
                case '√ó':
                    a = Math.floor(Math.random() * (level + 2)) + 1;
                    b = Math.floor(Math.random() * (level + 2)) + 1;
                    answer = a * b;
                    break;
                case '√∑':
                    b = Math.floor(Math.random() * (level + 2)) + 1;
                    answer = Math.floor(Math.random() * (level + 2)) + 1;
                    a = b * answer;
                    break;
            }

            currentAnswer = answer;

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
            document.getElementById('problem').textContent = `${a} ${operation} ${b} = ?`;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
            generateAnswers(answer, maxNumber);
        }

        function generateAnswers(correctAnswer, maxNumber) {
            const answersGrid = document.getElementById('answers');
            answersGrid.innerHTML = '';

            const answers = new Set([correctAnswer]);

            // –î–æ–±–∞–≤–ª—è–µ–º 3 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞
            while (answers.size < 4) {
                let wrongAnswer;
                do {
                    // –°–æ–∑–¥–∞–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –±–ª–∏–∑–∫–∏–π –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É
                    const offset = Math.floor(Math.random() * 5) + 1;
                    const sign = Math.random() > 0.5 ? 1 : -1;
                    wrongAnswer = correctAnswer + (sign * offset);

                    // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –æ—Ç–≤–µ—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∏ —Ä–∞–∑—É–º–Ω—ã–π
                    if (wrongAnswer < 0) wrongAnswer = Math.abs(wrongAnswer);
                    if (wrongAnswer > maxNumber * 2) wrongAnswer = Math.floor(wrongAnswer / 2);

                } while (answers.has(wrongAnswer) || wrongAnswer < 0);
                answers.add(wrongAnswer);
            }

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º
            const answersArray = Array.from(answers);
            for (let i = answersArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [answersArray[i], answersArray[j]] = [answersArray[j], answersArray[i]];
            }

            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
            answersArray.forEach(answer => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.onclick = () => checkAnswer(answer);
                answersGrid.appendChild(button);
            });
        }

        function checkAnswer(answer) {
            if (answer === currentAnswer) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                correct++;
                problemsSolved++;
                fuel = Math.min(100, fuel + 20);
                rocketPosition += 20;

                // –ê–Ω–∏–º–∞—Ü–∏—è
                document.getElementById('rocket').style.bottom = rocketPosition + 'px';

                // –î–æ–±–∞–≤–ª—è–µ–º –∑–≤–µ–∑–¥—ã
                addStar();

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å
                if (problemsSolved % 5 === 0) {
                    level++;
                    alert(`üéâ –£—Ä–æ–≤–µ–Ω—å ${level}! –ü—Ä–∏–º–µ—Ä—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–ª–æ–∂–Ω–µ–µ!`);
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
                if (rocketPosition >= 250) {
                    endGame(true);
                }
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                wrong++;
                fuel = Math.max(0, fuel - 15);
                rocketPosition = Math.max(50, rocketPosition - 10);
                document.getElementById('rocket').style.bottom = rocketPosition + 'px';

                if (fuel <= 0) {
                    endGame(false);
                }
            }

            updateDisplay();
            generateProblem();
        }

        function checkAnswerInput() {
            const input = document.getElementById('answer-input');
            const answer = parseInt(input.value);

            if (!isNaN(answer)) {
                checkAnswer(answer);
                input.value = '';
            }
        }

        function updateDisplay() {
            document.getElementById('level').textContent = level;
            document.getElementById('correct').textContent = correct;
            document.getElementById('wrong').textContent = wrong;
            document.getElementById('fuel').textContent = fuel + '%';
            document.getElementById('fuel-fill').style.width = fuel + '%';
        }

        function resetGame() {
            level = 1;
            correct = 0;
            wrong = 0;
            fuel = 100;
            rocketPosition = 50;
            problemsSolved = 0;

            document.getElementById('rocket').style.bottom = '50px';
            updateDisplay();
            generateProblem();
        }

        function endGame(win) {
            if (win) {
                alert(`üéâ –ü–û–ë–ï–î–ê! –¢—ã –¥–æ–±—Ä–∞–ª—Å—è –¥–æ –õ—É–Ω—ã!\n–†–µ—à–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${correct} –ø—Ä–∏–º–µ—Ä–æ–≤\n–ü–æ–ª—É—á–µ–Ω–æ: ${correct} –∑–≤—ë–∑–¥!`);

                // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø–æ–±–µ–¥—É
                fetch('/add_star', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({count: correct, reason: '–î–æ–ª–µ—Ç–µ—Ç—å –¥–æ –õ—É–Ω—ã –≤ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ'})
                });
            } else {
                alert(`‚õΩ –¢–æ–ø–ª–∏–≤–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å!\n–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${correct}\n–ü–æ–ª—É—á–µ–Ω–æ: ${Math.floor(correct/2)} –∑–≤—ë–∑–¥!`);

                // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –∏–≥—Ä—É
                fetch('/add_star', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({count: Math.floor(correct/2), reason: '–£—á–∞—Å—Ç–∏–µ –≤ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–º —Å—á—ë—Ç–µ'})
                });
            }

            resetGame();
        }

        function addStar() {
            fetch('/add_star', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({count: 1, reason: '–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç'})
            });
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            resetGame();
        });
    </script>

</body>
</html>