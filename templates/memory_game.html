<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            color: #ffff00;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .game-instructions {
            color: #aaa;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 20px;
            line-height: 1.5;
        }

        .game-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .game-wrapper {
                flex-direction: row;
            }
        }

        .game-area {
            flex: 3;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            border: 4px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            min-height: 500px;
            max-height: 600px; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å—ë —á—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç */
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
        .cards-container {
            flex-grow: 1;
            overflow-y: auto; /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
            padding: 10px;
            margin-top: 10px;
        }

        .game-info {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #ff00ff;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-section {
            margin-bottom: 15px;
        }

        .info-title {
            color: #00ffff;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            color: #ffff00;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.9rem;
        }

        .difficulty-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .difficulty-btn {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #00ffaa;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .difficulty-btn:hover {
            background: rgba(0, 255, 170, 0.2);
            transform: translateY(-3px);
        }

        .difficulty-btn.active {
            background: #00ffaa;
            color: black;
            font-weight: bold;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            flex-grow: 1;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
        }

        .card {
            aspect-ratio: 3/4;
            background: linear-gradient(135deg, #3a3a7a, #4a4a9a);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            position: relative;
            border: 3px solid transparent;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            border-color: #00ff00;
            box-shadow: 0 0 20px #00ff00;
            cursor: default;
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-back {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            font-size: 2.5rem;
            color: white;
        }

        .card-front {
            background: linear-gradient(135deg, #2a2a5a, #3a3a7a);
            transform: rotateY(180deg);
            font-size: 3rem;
            padding: 10px;
        }

        .card:hover:not(.flipped):not(.matched) {
            border-color: #ffff00;
            transform: translateY(-5px);
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
            justify-content: center;
        }

        .control-btn:hover {
            transform: translateY(-5px);
        }

        .start-btn {
            background: linear-gradient(45deg, #00ff00, #00aa00);
            color: white;
        }

        .hint-btn {
            background: linear-gradient(45deg, #ffff00, #ffaa00);
            color: black;
        }

        .reset-btn {
            background: linear-gradient(45deg, #ff4444, #aa0000);
            color: white;
        }

        .back-btn {
            background: linear-gradient(45deg, #4444ff, #0000aa);
            color: white;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 25px;
            background: linear-gradient(45deg, #ff0066, #ff5500);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 30px;
            border-radius: 20px;
            border: 3px solid gold;
            text-align: center;
            z-index: 100;
            display: none;
            min-width: 300px;
            max-width: 400px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
        }

        .message-title {
            color: gold;
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .message-text {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .message-stats {
            color: #aaa;
            font-size: 1rem;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .timer-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-display {
            font-size: 2.5rem;
            font-family: 'Digital-7', monospace;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
            margin: 10px 0;
        }

        .timer-label {
            color: #aaa;
            font-size: 1rem;
        }

        .combo-counter {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            margin-top: 10px;
            border: 2px solid gold;
            display: none;
        }

        .combo-text {
            color: gold;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .hint-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 12px;
            display: none;
            animation: pulseHint 2s infinite;
        }

        @keyframes pulseHint {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }

        .card-shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: rotateY(180deg) translateX(0); }
            25% { transform: rotateY(180deg) translateX(-10px); }
            75% { transform: rotateY(180deg) translateX(10px); }
        }

        .card-match {
            animation: matchGlow 0.5s;
        }

        @keyframes matchGlow {
            0%, 100% {
                box-shadow: 0 0 20px #00ff00;
                transform: rotateY(180deg) scale(1);
            }
            50% {
                box-shadow: 0 0 40px #00ff00;
                transform: rotateY(180deg) scale(1.1);
            }
        }

        .level-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            color: black;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
    </style>
</head>
<body class="kid-mode">
    <div class="starfield"></div>

    <button class="back-button" onclick="window.location.href='/games'">
        <i class="fas fa-arrow-left"></i> –ö –∏–≥—Ä–∞–º
    </button>

    <div class="container">
        <div class="game-container">
            <div class="game-header">
                <h1 class="game-title">üß† –ö–û–°–ú–ò–ß–ï–°–ö–ê–Ø –ü–ê–ú–Ø–¢–¨</h1>
                <p class="game-instructions">
                    –ù–∞–π–¥–∏ –≤—Å–µ –ø–∞—Ä—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫! –ß–µ–º –±—ã—Å—Ç—Ä–µ–µ –∏ —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ö–æ–¥–æ–≤ - —Ç–µ–º –±–æ–ª—å—à–µ –∑–≤—ë–∑–¥ –ø–æ–ª—É—á–∏—à—å!
                </p>
            </div>

            <div class="game-wrapper">
                <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
                <div class="game-area">
                    <div class="level-badge" id="levelBadge">–õ–Å–ì–ö–ò–ô</div>

                    <!-- –¢–∞–π–º–µ—Ä -->
                    <div class="timer-container">
                        <div class="timer-label">‚è±Ô∏è –í–†–ï–ú–Ø</div>
                        <div class="timer-display" id="timerDisplay">00:00</div>
                    </div>

                    <!-- –°—á—ë—Ç—á–∏–∫ –∫–æ–º–±–æ -->
                    <div class="combo-counter" id="comboCounter">
                        <div class="combo-text" id="comboText">–ö–û–ú–ë–û x1!</div>
                    </div>

                    <!-- –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
                    <div class="cards-container">
                        <div class="cards-grid" id="cardsGrid">
                            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="game-info">
                    <div class="info-section">
                        <h2 class="info-title"><i class="fas fa-chart-bar"></i> –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="movesValue">0</div>
                                <div class="stat-label">üìä –•–æ–¥–æ–≤</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="pairsValue">0</div>
                                <div class="stat-label">üß© –ù–∞–π–¥–µ–Ω–æ –ø–∞—Ä</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="accuracyValue">0%</div>
                                <div class="stat-label">üéØ –¢–æ—á–Ω–æ—Å—Ç—å</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="scoreValue">0</div>
                                <div class="stat-label">‚≠ê –û—á–∫–∏</div>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h2 class="info-title"><i class="fas fa-sliders-h"></i> –£–†–û–í–ï–ù–¨ –°–õ–û–ñ–ù–û–°–¢–ò</h2>
                        <div class="difficulty-selector">
                            <button class="difficulty-btn active" onclick="setDifficulty('easy')" id="easyBtn">
                                üü¢ –õ–Å–ì–ö–ò–ô (6 –ø–∞—Ä)
                            </button>
                            <button class="difficulty-btn" onclick="setDifficulty('medium')" id="mediumBtn">
                                üü° –°–†–ï–î–ù–ò–ô (8 –ø–∞—Ä)
                            </button>
                            <button class="difficulty-btn" onclick="setDifficulty('hard')" id="hardBtn">
                                üî¥ –°–õ–û–ñ–ù–´–ô (12 –ø–∞—Ä)
                            </button>
                        </div>
                    </div>

                    <div class="info-section">
                        <h2 class="info-title"><i class="fas fa-trophy"></i> –ù–ê–ì–†–ê–î–´</h2>
                        <div style="color: #aaa; font-size: 0.9rem; line-height: 1.5;">
                            ‚≠ê +4 –∑–≤–µ–∑–¥—ã –∑–∞ –ø–æ–±–µ–¥—É<br>
                            ‚≠ê –ë–æ–Ω—É—Å –∑–∞ —Å–∫–æ—Ä–æ—Å—Ç—å<br>
                            ‚≠ê –ë–æ–Ω—É—Å –∑–∞ —Ç–æ—á–Ω–æ—Å—Ç—å<br>
                            ‚≠ê –ë–æ–Ω—É—Å –∑–∞ –∫–æ–º–±–æ<br>
                            üèÜ –ú–∞–∫—Å–∏–º—É–º: 15 –∑–≤—ë–∑–¥!
                        </div>
                    </div>

                    <div class="info-section">
                        <h2 class="info-title"><i class="fas fa-lightbulb"></i> –°–û–í–ï–¢–´</h2>
                        <div style="color: #aaa; font-size: 0.9rem; line-height: 1.5;">
                            ‚Ä¢ –ó–∞–ø–æ–º–∏–Ω–∞–π —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫<br>
                            ‚Ä¢ –ò—â–∏ –ø–∞—Ä–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏<br>
                            ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏–∏<br>
                            ‚Ä¢ –°—Ç—Ä–æ–π –∫–æ–º–±–æ –¥–ª—è –±–æ–Ω—É—Å–Ω—ã—Ö –æ—á–∫–æ–≤
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="game-controls">
                <button class="control-btn start-btn" onclick="startGame()" id="startButton">
                    <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
                <button class="control-btn hint-btn" onclick="useHint()" id="hintButton" disabled>
                    <i class="fas fa-lightbulb"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∞ (<span id="hintCount">3</span>)
                </button>
                <button class="control-btn reset-btn" onclick="resetGame()">
                    <i class="fas fa-redo"></i> –ó–∞–Ω–æ–≤–æ
                </button>
                <button class="control-btn back-btn" onclick="window.location.href='/games'">
                    <i class="fas fa-gamepad"></i> –î—Ä—É–≥–∏–µ –∏–≥—Ä—ã
                </button>
            </div>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ -->
    <div class="game-message" id="winMessage">
        <div class="message-title">üéâ –ü–û–ë–ï–î–ê!</div>
        <div class="message-text">–¢—ã –Ω–∞—à—ë–ª –≤—Å–µ –ø–∞—Ä—ã!</div>
        <div class="message-stats" id="winStats"></div>
        <button class="control-btn start-btn" onclick="nextLevel()" style="width: 100%; margin-bottom: 10px;">
            <i class="fas fa-arrow-right"></i> –°–õ–ï–î–£–Æ–©–ò–ô –£–†–û–í–ï–ù–¨
        </button>
        <button class="control-btn reset-btn" onclick="resetGame()" style="width: 100%;">
            <i class="fas fa-redo"></i> –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê
        </button>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∫–æ—Ä–¥–µ -->
    <div class="game-message" id="recordMessage">
        <div class="message-title">üèÜ –ù–û–í–´–ô –†–ï–ö–û–†–î!</div>
        <div class="message-text" id="recordText"></div>
        <div class="message-stats" id="recordStats"></div>
        <button class="control-btn start-btn" onclick="closeMessage('recordMessage')" style="width: 100%;">
            <i class="fas fa-check"></i> –û–¢–õ–ò–ß–ù–û!
        </button>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameActive = false;
        let gameStarted = false;
        let timerInterval;
        let seconds = 0;
        let minutes = 0;

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã
        let stats = {
            moves: 0,
            pairsFound: 0,
            totalPairs: 6,
            accuracy: 0,
            score: 0,
            hints: 3,
            combo: 0,
            maxCombo: 0,
            wrongGuesses: 0
        };

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        let difficulty = 'easy';
        const difficulties = {
            easy: { pairs: 6, timeBonus: 30, comboBonus: 5 },
            medium: { pairs: 8, timeBonus: 45, comboBonus: 7 },
            hard: { pairs: 12, timeBonus: 60, comboBonus: 10 }
        };

        // –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä—ã
        let cards = [];
        let flippedCards = [];
        let matchedCards = [];
        let cardEmojis = [];

        // –ò–≥—Ä–æ–≤—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ (—ç–º–æ–¥–∑–∏)
        const spaceEmojis = [
            'üöÄ', 'ü™ê', '‚≠ê', 'üåô', 'üëΩ', 'üë®‚ÄçüöÄ',
            'üõ∞Ô∏è', '‚òÑÔ∏è', 'üåç', 'üåå', 'üõ∏', 'üî≠',
            'üí´', 'üåü', 'ü™∂', 'üß™', '‚ö°', 'üåÄ'
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å"');

            // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–Ω–æ–µ –ø–æ–ª–µ
            createStarfield();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
            setupGame();

            console.log('–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã
        function setupGame() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            resetStats();

            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
            createCards();

            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUI();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ—Ç–∫—É –∫–∞—Ä—Ç–æ—á–µ–∫
            renderCards();
        }

        // –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function resetStats() {
            const diff = difficulties[difficulty];

            stats = {
                moves: 0,
                pairsFound: 0,
                totalPairs: diff.pairs,
                accuracy: 0,
                score: 0,
                hints: 3,
                combo: 0,
                maxCombo: 0,
                wrongGuesses: 0
            };

            seconds = 0;
            minutes = 0;
            cards = [];
            flippedCards = [];
            matchedCards = [];

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
            updateTimerDisplay();

            // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            closeAllMessages();

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('hintButton').disabled = true;
            document.getElementById('startButton').disabled = false;

            gameActive = false;
            gameStarted = false;

            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            clearInterval(timerInterval);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
        function createCards() {
            const diff = difficulties[difficulty];
            const pairsCount = diff.pairs;

            // –¢–µ–º—ã –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ (—Ç–æ–ª—å–∫–æ 8 –ø–∞—Ä, –∫–∞–∫ –≤ –≤–∞—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö)
            const cardThemes = [
                { name: '–†–∞–∫–µ—Ç–∞', pairId: 1, emoji: 'üöÄ', imageA: 'memory1_a.png', imageB: 'memory1_b.png' },
                { name: '–ö–æ—Å–º–æ–Ω–∞–≤—Ç', pairId: 2, emoji: 'üë®‚ÄçüöÄ', imageA: 'memory2_a.png', imageB: 'memory2_b.png' },
                { name: '–ò–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω', pairId: 3, emoji: 'üëΩ', imageA: 'memory3_a.png', imageB: 'memory3_b.png' },
                { name: '–°–ø—É—Ç–Ω–∏–∫', pairId: 4, emoji: 'üõ∞Ô∏è', imageA: 'memory4_a.png', imageB: 'memory4_b.png' },
                { name: '–ó–≤–µ–∑–¥–∞', pairId: 5, emoji: '‚≠ê', imageA: 'memory5_a.png', imageB: 'memory5_b.png' },
                { name: '–ü–ª–∞–Ω–µ—Ç–∞', pairId: 6, emoji: 'ü™ê', imageA: 'memory6_a.png', imageB: 'memory6_b.png' },
                { name: '–ö–æ–º–µ—Ç–∞', pairId: 7, emoji: '‚òÑÔ∏è', imageA: 'memory7_a.png', imageB: 'memory7_b.png' },
                { name: '–¢—Ä–æ—Ñ–µ–π', pairId: 8, emoji: 'üèÜ', imageA: 'memory8_a.png', imageB: 'memory8_b.png' }
            ];

            // –í—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä (–¥–ª—è easy - 6, medium - 8, hard - 8)
            const selectedThemes = cardThemes.slice(0, pairsCount);

            // –°–æ–∑–¥–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            let allCards = [];

            selectedThemes.forEach(theme => {
                // –ö–∞—Ä—Ç–æ—á–∫–∞ A (–ª–µ–≤–∞—è/–≤–µ—Ä—Ö–Ω—è—è)
                allCards.push({
                    id: allCards.length,
                    pairId: theme.pairId,
                    name: theme.name,
                    emoji: theme.emoji,
                    image: theme.imageA,
                    isA: true
                });

                // –ö–∞—Ä—Ç–æ—á–∫–∞ B (–ø—Ä–∞–≤–∞—è/–Ω–∏–∂–Ω—è—è)
                allCards.push({
                    id: allCards.length,
                    pairId: theme.pairId,
                    name: theme.name,
                    emoji: theme.emoji,
                    image: theme.imageB,
                    isA: false
                });
            });

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
            allCards = allCards.sort(() => Math.random() - 0.5);

            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –∏–≥—Ä—ã
            cards = allCards.map((cardInfo, index) => ({
                id: index,
                gameId: cardInfo.id,
                pairId: cardInfo.pairId,
                name: cardInfo.name,
                emoji: cardInfo.emoji,
                image: cardInfo.image,
                isA: cardInfo.isA,
                flipped: false,
                matched: false,
                element: null
            }));

            console.log('–°–æ–∑–¥–∞–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫:', cards.length);
            console.log('–ö–∞—Ä—Ç–æ—á–∫–∏:', cards);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            grid.innerHTML = '';

            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–µ—Ç–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
            const pairsCount = difficulties[difficulty].pairs;
            const totalCards = pairsCount * 2;
            const screenWidth = window.innerWidth;

            // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
            let columns;

            if (screenWidth >= 1024) { // –ë–æ–ª—å—à–∏–µ —ç–∫—Ä–∞–Ω—ã
                if (totalCards <= 12) {
                    columns = 4;
                } else if (totalCards <= 16) {
                    columns = 4;
                } else {
                    columns = 6;
                }
            } else if (screenWidth >= 768) { // –ü–ª–∞–Ω—à–µ—Ç—ã
                if (totalCards <= 12) {
                    columns = 3;
                } else if (totalCards <= 16) {
                    columns = 4;
                } else {
                    columns = 5;
                }
            } else { // –ú–æ–±–∏–ª—å–Ω—ã–µ
                if (totalCards <= 12) {
                    columns = 2;
                } else if (totalCards <= 16) {
                    columns = 3;
                } else {
                    columns = 4;
                }
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫
            const cardSize = Math.min(
                150, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                Math.max(80, 400 / columns - 20) // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
            );

            grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            grid.style.gap = `${Math.min(15, cardSize * 0.1)}px`;

            // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            const fontSizeMultiplier = totalCards > 16 ? 0.8 : 1;

            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.index = index;
                cardElement.style.minHeight = `${cardSize}px`; // –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É

                cardElement.innerHTML = `
                    <div class="card-back">
                        <div style="
                            width: 100%;
                            height: 100%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: ${cardSize * 0.4}px;
                            color: white;
                            background: linear-gradient(45deg, #ff00ff, #00ffff);
                            border-radius: 12px;
                        ">
                            <div>?</div>
                        </div>
                    </div>
                    <div class="card-front">
                        <div style="
                            width: 100%;
                            height: 100%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 10px;
                            background: linear-gradient(135deg, #2a2a5a, #3a3a7a);
                            border-radius: 12px;
                        ">
                            <!-- –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
                            <img src="/static/game_images/memory/${card.image}"
                                 alt="${card.name}"
                                 style="
                                     max-width: 90%;
                                     max-height: 90%;
                                     object-fit: contain;
                                 "
                                 onerror="
                                     // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏
                                     this.style.display='none';
                                     const parent = this.parentElement;
                                     const emojiDiv = document.createElement('div');
                                     emojiDiv.style.cssText = 'font-size: ${cardSize * 0.5}px;';
                                     emojiDiv.textContent = '${card.emoji}';
                                     parent.appendChild(emojiDiv);
                                 ">
                        </div>
                    </div>
                    <div class="hint-overlay" id="hint-${index}"></div>
                `;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                cardElement.addEventListener('click', () => flipCard(index));

                grid.appendChild(cardElement);
                card.element = cardElement;
            });
        }

        // –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
        function flipCard(index) {
            if (!gameActive || !gameStarted) return;

            const card = cards[index];

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É
            if (card.flipped || card.matched || flippedCards.length >= 2) return;

            // –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
            card.flipped = true;
            card.element.classList.add('flipped');
            flippedCards.push(index);

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫
            playSound('flip');

            // –ï—Å–ª–∏ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ –¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            if (flippedCards.length === 2) {
                stats.moves++;
                checkForMatch();
            }

            updateUI();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
        function checkForMatch() {
            const [index1, index2] = flippedCards;
            const card1 = cards[index1];
            const card2 = cards[index2];

            console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:');
            console.log('–ö–∞—Ä—Ç–æ—á–∫–∞ 1:', card1);
            console.log('–ö–∞—Ä—Ç–æ—á–∫–∞ 2:', card2);

            // –ö–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –µ—Å–ª–∏ —É –Ω–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π pairId
            // (—Ç.–µ. —ç—Ç–æ –ø–∞—Ä–∞ A –∏ B –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Ç–µ–º—ã)
            if (card1.pairId === card2.pairId) {
                console.log('‚úÖ –ù–∞–π–¥–µ–Ω–∞ –ø–∞—Ä–∞! –¢–µ–º–∞:', card1.name);

                // –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                card1.matched = true;
                card2.matched = true;

                // –ê–Ω–∏–º–∞—Ü–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                card1.element.classList.add('matched');
                card2.element.classList.add('matched');
                card1.element.classList.add('card-match');
                card2.element.classList.add('card-match');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                stats.pairsFound++;
                stats.combo++;
                stats.maxCombo = Math.max(stats.maxCombo, stats.combo);

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å
                stats.accuracy = Math.round((stats.pairsFound / stats.moves) * 100) || 0;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏
                const basePoints = 100;
                const comboBonus = stats.combo * 10;
                stats.score += basePoints + comboBonus;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–±–æ
                if (stats.combo > 1) {
                    showCombo(stats.combo);
                }

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —É—Å–ø–µ—Ö–∞
                playSound('match');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
                if (stats.pairsFound === stats.totalPairs) {
                    setTimeout(() => {
                        winGame();
                    }, 500);
                }

                // –û—á–∏—â–∞–µ–º –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => {
                    flippedCards = [];
                }, 1000);

            } else {
                console.log('‚ùå –ù–µ –ø–∞—Ä–∞!');

                // –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                stats.combo = 0;
                stats.wrongGuesses++;

                // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                card1.element.classList.add('card-shake');
                card2.element.classList.add('card-shake');

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –æ—à–∏–±–∫–∏
                playSound('error');

                // –ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    card1.flipped = false;
                    card2.flipped = false;
                    card1.element.classList.remove('flipped', 'card-shake');
                    card2.element.classList.remove('flipped', 'card-shake');
                    flippedCards = [];
                }, 1500);
            }

            updateUI();
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            if (gameStarted) return;

            gameActive = true;
            gameStarted = true;

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            startTimer();

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('startButton').disabled = true;
            document.getElementById('hintButton').disabled = false;

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            closeAllMessages();

            console.log('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å');
        }

        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        function startTimer() {
            seconds = 0;
            minutes = 0;
            updateTimerDisplay();

            timerInterval = setInterval(() => {
                seconds++;
                if (seconds === 60) {
                    seconds = 0;
                    minutes++;
                }
                updateTimerDisplay();
            }, 1000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
        function updateTimerDisplay() {
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = timeStr;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            document.getElementById('movesValue').textContent = stats.moves;
            document.getElementById('pairsValue').textContent = `${stats.pairsFound}/${stats.totalPairs}`;
            document.getElementById('accuracyValue').textContent = `${stats.accuracy}%`;
            document.getElementById('scoreValue').textContent = stats.score;
            document.getElementById('hintCount').textContent = stats.hints;

            // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ —É—Ä–æ–≤–Ω—è
            const levelNames = {
                easy: '–õ–Å–ì–ö–ò–ô',
                medium: '–°–†–ï–î–ù–ò–ô',
                hard: '–°–õ–û–ñ–ù–´–ô'
            };
            document.getElementById('levelBadge').textContent = levelNames[difficulty];
        }

        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
        function useHint() {
            if (!gameActive || stats.hints <= 0) return;

            stats.hints--;

            // –ù–∞—Ö–æ–¥–∏–º –Ω–µ–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ã–µ –∏ –Ω–µ—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            const availableCards = cards.filter(card => !card.flipped && !card.matched);

            if (availableCards.length >= 2) {
                // –í—ã–±–∏—Ä–∞–µ–º –¥–≤–µ —Å–ª—É—á–∞–π–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                const randomCards = availableCards.sort(() => Math.random() - 0.5).slice(0, 2);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                randomCards.forEach(card => {
                    const hintOverlay = document.getElementById(`hint-${card.id}`);
                    if (hintOverlay) {
                        hintOverlay.style.display = 'block';

                        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                        setTimeout(() => {
                            hintOverlay.style.display = 'none';
                        }, 2000);
                    }
                });

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫
                playSound('hint');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification('üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!');
            }

            updateUI();
        }

        // –ü–æ–∫–∞–∑ –∫–æ–º–±–æ
        function showCombo(comboCount) {
            const comboCounter = document.getElementById('comboCounter');
            const comboText = document.getElementById('comboText');

            comboText.textContent = `–ö–û–ú–ë–û x${comboCount}!`;
            comboCounter.style.display = 'block';

            // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                comboCounter.style.display = 'none';
            }, 2000);
        }

        // –ü–æ–±–µ–¥–∞ –≤ –∏–≥—Ä–µ
        async function winGame() {
            gameActive = false;
            clearInterval(timerInterval);

            // –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã
            const totalTime = minutes * 60 + seconds;
            const timeBonus = calculateTimeBonus(totalTime);
            const accuracyBonus = calculateAccuracyBonus(stats.accuracy);
            const comboBonus = calculateComboBonus(stats.maxCombo);
            const baseStars = 4;

            const totalStars = baseStars + timeBonus + accuracyBonus + comboBonus;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ
            document.getElementById('winStats').innerHTML = `
                ‚è±Ô∏è –í—Ä–µ–º—è: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}<br>
                üìä –•–æ–¥–æ–≤: ${stats.moves}<br>
                üéØ –¢–æ—á–Ω–æ—Å—Ç—å: ${stats.accuracy}%<br>
                üß© –ö–æ–º–±–æ: x${stats.maxCombo}<br>
                ‚≠ê –û—á–∫–∏: ${stats.score}<br>
                <br>
                <span style="color: gold; font-size: 1.3rem;">
                    üéÅ –ù–∞–≥—Ä–∞–¥–∞: +${totalStars} –∑–≤—ë–∑–¥!<br>
                    (${baseStars} + ${timeBonus} + ${accuracyBonus} + ${comboBonus})
                </span>
            `;
            showMessage('winMessage');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∫–æ—Ä–¥
            checkForRecord(totalTime, stats.moves);

            // –ù–∞—á–∏—Å–ª—è–µ–º –∑–≤—ë–∑–¥—ã
            try {
                const response = await fetch('/add_star', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        count: totalStars,
                        reason: `–ü–æ–±–µ–¥–∏–ª –≤ –∏–≥—Ä–µ "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å" (${difficulty})`
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showNotification(`‚≠ê –ü–æ–ª—É—á–µ–Ω–æ ${totalStars} –∑–≤—ë–∑–¥! –í—Å–µ–≥–æ: ${data.stars}`);
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–≤—ë–∑–¥:', error);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ
            updateUserProfile();

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø–æ–±–µ–¥—ã
            playSound('success');
        }

        // –†–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–∞ –∑–∞ –≤—Ä–µ–º—è
        function calculateTimeBonus(totalSeconds) {
            const diff = difficulties[difficulty];
            const maxTime = diff.timeBonus;

            if (totalSeconds <= maxTime * 0.3) return 3; // –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ
            if (totalSeconds <= maxTime * 0.6) return 2; // –ë—ã—Å—Ç—Ä–æ
            if (totalSeconds <= maxTime) return 1;       // –í –ø—Ä–µ–¥–µ–ª–∞—Ö –≤—Ä–µ–º–µ–Ω–∏
            return 0;                                    // –ú–µ–¥–ª–µ–Ω–Ω–æ
        }

        // –†–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–∞ –∑–∞ —Ç–æ—á–Ω–æ—Å—Ç—å
        function calculateAccuracyBonus(accuracy) {
            if (accuracy >= 90) return 3;
            if (accuracy >= 75) return 2;
            if (accuracy >= 60) return 1;
            return 0;
        }

        // –†–∞—Å—á–µ—Ç –±–æ–Ω—É—Å–∞ –∑–∞ –∫–æ–º–±–æ
        function calculateComboBonus(maxCombo) {
            const diff = difficulties[difficulty];
            const targetCombo = diff.comboBonus;

            if (maxCombo >= targetCombo) return 3;
            if (maxCombo >= targetCombo * 0.7) return 2;
            if (maxCombo >= targetCombo * 0.4) return 1;
            return 0;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∫–æ—Ä–¥–∞
        function checkForRecord(time, moves) {
            const storageKey = `memory_record_${difficulty}`;
            const currentRecord = localStorage.getItem(storageKey);

            if (!currentRecord) {
                // –ü–µ—Ä–≤–∞—è –∏–≥—Ä–∞ –Ω–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ
                saveRecord(time, moves);
                showRecordMessage(true, time, moves);
            } else {
                const record = JSON.parse(currentRecord);

                // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ö–æ–¥–∞–º
                const currentScore = (1 / (time + 1)) * 1000 + (1 / (moves + 1)) * 100;
                const recordScore = (1 / (record.time + 1)) * 1000 + (1 / (record.moves + 1)) * 100;

                if (currentScore > recordScore) {
                    // –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!
                    saveRecord(time, moves);
                    showRecordMessage(false, time, moves, record);
                }
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
        function saveRecord(time, moves) {
            const storageKey = `memory_record_${difficulty}`;
            const record = {
                time: time,
                moves: moves,
                date: new Date().toISOString()
            };
            localStorage.setItem(storageKey, JSON.stringify(record));
        }

        // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ä–µ–∫–æ—Ä–¥–µ
        function showRecordMessage(isFirst, time, moves, oldRecord = null) {
            const timeStr = `${Math.floor(time / 60).toString().padStart(2, '0')}:${(time % 60).toString().padStart(2, '0')}`;

            if (isFirst) {
                document.getElementById('recordText').textContent = '–¢—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø–µ—Ä–≤—ã–π —Ä–µ–∫–æ—Ä–¥!';
                document.getElementById('recordStats').innerHTML = `
                    ‚è±Ô∏è –í—Ä–µ–º—è: ${timeStr}<br>
                    üìä –•–æ–¥–æ–≤: ${moves}
                `;
            } else {
                const oldTimeStr = `${Math.floor(oldRecord.time / 60).toString().padStart(2, '0')}:${(oldRecord.time % 60).toString().padStart(2, '0')}`;
                const timeImprovement = oldRecord.time - time;
                const movesImprovement = oldRecord.moves - moves;

                document.getElementById('recordText').textContent = '–¢—ã –ø–æ–±–∏–ª —Å–≤–æ–π —Ä–µ–∫–æ—Ä–¥!';
                document.getElementById('recordStats').innerHTML = `
                    ‚è±Ô∏è –í—Ä–µ–º—è: ${timeStr} (–±—ã–ª–æ ${oldTimeStr})<br>
                    üìä –•–æ–¥–æ–≤: ${moves} (–±—ã–ª–æ ${oldRecord.moves})<br>
                    üéâ –£–ª—É—á—à–µ–Ω–∏–µ: ${timeImprovement}—Å–µ–∫ –∏ ${movesImprovement} —Ö–æ–¥–æ–≤!
                `;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã
            setTimeout(() => {
                showMessage('recordMessage');
            }, 1500);
        }

        // –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
        function nextLevel() {
            // –ü–æ–≤—ã—à–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ
            if (difficulty === 'easy') {
                setDifficulty('medium');
            } else if (difficulty === 'medium') {
                setDifficulty('hard');
            }

            resetGame();
            startGame();
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        function setDifficulty(level) {
            difficulty = level;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.getElementById('easyBtn').classList.remove('active');
            document.getElementById('mediumBtn').classList.remove('active');
            document.getElementById('hardBtn').classList.remove('active');
            document.getElementById(`${level}Btn`).classList.add('active');

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É
            if (!gameStarted) {
                setupGame();
            }
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function resetGame() {
            clearInterval(timerInterval);
            setupGame();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function updateUserProfile() {
            try {
                await fetch('/update_profile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        games_played: 'increment'
                    })
                });
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        function showMessage(messageId) {
            document.getElementById(messageId).style.display = 'block';
        }

        function closeMessage(messageId) {
            document.getElementById(messageId).style.display = 'none';
        }

        function closeAllMessages() {
            closeMessage('winMessage');
            closeMessage('recordMessage');
        }

        // –ó–≤—É–∫–∏
        function playSound(type) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—ã–ª–∏ –±—ã –∑–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã
            console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞:', type);
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 15px 25px;
                border-radius: 15px;
                border-left: 5px solid gold;
                max-width: 300px;
                z-index: 10000;
                animation: slideIn 0.3s;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤–µ–∑–¥–Ω–æ–≥–æ –ø–æ–ª—è
        function createStarfield() {
            const starfield = document.querySelector('.starfield');
            starfield.innerHTML = '';

            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 3 + 1}px;
                    height: ${Math.random() * 3 + 1}px;
                    background: white;
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: twinkle ${Math.random() * 3 + 2}s infinite;
                    animation-delay: ${Math.random() * 3}s;
                `;
                starfield.appendChild(star);
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        function addGameStyles() {
            if (!document.getElementById('memory-game-styles')) {
                const style = document.createElement('style');
                style.id = 'memory-game-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }

                    @keyframes pulseHint {
                        0%, 100% { opacity: 0.3; }
                        50% { opacity: 0.7; }
                    }

                    @keyframes shake {
                        0%, 100% { transform: rotateY(180deg) translateX(0); }
                        25% { transform: rotateY(180deg) translateX(-10px); }
                        75% { transform: rotateY(180deg) translateX(10px); }
                    }

                    @keyframes matchGlow {
                        0%, 100% {
                            box-shadow: 0 0 20px #00ff00;
                            transform: rotateY(180deg) scale(1);
                        }
                        50% {
                            box-shadow: 0 0 40px #00ff00;
                            transform: rotateY(180deg) scale(1.1);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä—ã "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å" –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            addGameStyles();
            initGame();
        });
    </script>

</body>
</html>