<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ –õ–µ—Ç–∏ –Ω–∞ –õ—É–Ω—É</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .game-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            color: #ffff00;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .game-instructions {
            color: #aaa;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 20px;
            line-height: 1.5;
        }

        .game-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .game-wrapper {
                flex-direction: row;
            }
        }

        .game-area {
            flex: 3;
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            border: 4px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        .game-canvas {
            background: linear-gradient(180deg, #0a0a2a 0%, #1a1a4a 50%, #0a0a2a 100%);
            display: block;
            width: 100%;
            height: 500px;
        }

        .game-info {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #ff00ff;
        }

        .info-section {
            margin-bottom: 25px;
        }

        .info-title {
            color: #00ffff;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            color: #ffff00;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.9rem;
        }

        .controls-section {
            margin-top: 20px;
        }

        .controls-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #aaa;
        }

        .key {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #00ffaa;
            border-radius: 8px;
            padding: 5px 10px;
            font-weight: bold;
            color: white;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
            justify-content: center;
        }

        .control-btn:hover {
            transform: translateY(-5px);
        }

        .start-btn {
            background: linear-gradient(45deg, #00ff00, #00aa00);
            color: white;
        }

        .pause-btn {
            background: linear-gradient(45deg, #ffff00, #ffaa00);
            color: black;
        }

        .reset-btn {
            background: linear-gradient(45deg, #ff4444, #aa0000);
            color: white;
        }

        .back-btn {
            background: linear-gradient(45deg, #4444ff, #0000aa);
            color: white;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 25px;
            background: linear-gradient(45deg, #ff0066, #ff5500);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 20px;
            border: 3px solid gold;
            text-align: center;
            z-index: 100;
            display: none;
            min-width: 300px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
        }

        .message-title {
            color: gold;
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .message-text {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .message-stats {
            color: #aaa;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            justify-content: center;
            gap: 30px;
            padding: 20px;
        }

        .mobile-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 3px solid #00ffff;
            color: white;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }

        .mobile-btn:active {
            background: rgba(0, 255, 255, 0.3);
        }

        @media (max-width: 768px) {
            .mobile-controls {
                display: flex;
            }

            .game-canvas {
                height: 400px;
            }

            .game-wrapper {
                flex-direction: column;
            }
        }

        .fuel-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .fuel-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff5500, #ffff00);
            border-radius: 5px;
            width: 100%;
            transition: width 0.3s;
        }

        .progress-bar {
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s;
        }

        .star-animation {
            position: absolute;
            pointer-events: none;
            z-index: 10;
            animation: collectStar 0.5s forwards;
        }

        @keyframes collectStar {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(0) translateY(-50px);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="kid-mode">
    <div class="starfield"></div>

    <button class="back-button" onclick="window.location.href='/games'">
        <i class="fas fa-arrow-left"></i> –ö –∏–≥—Ä–∞–º
    </button>

    <div class="container">
        <div class="game-container">
            <div class="game-header">
                <h1 class="game-title">üöÄ –õ–ï–¢–ò –ù–ê –õ–£–ù–£</h1>
                <p class="game-instructions">
                    –£–ø—Ä–∞–≤–ª—è–π —Ä–∞–∫–µ—Ç–æ–π —Å –ø–æ–º–æ—â—å—é –∫–ª–∞–≤–∏—à WASD –∏–ª–∏ —Å—Ç—Ä–µ–ª–æ—á–µ–∫! –°–æ–±–∏—Ä–∞–π –∑–≤—ë–∑–¥—ã, –∏–∑–±–µ–≥–∞–π –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤ –∏ –¥–æ–ª–µ—Ç–∏ –¥–æ –õ—É–Ω—ã!
                </p>
            </div>

            <div class="game-wrapper">
                <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
                <div class="game-area">
                    <canvas id="gameCanvas" class="game-canvas"></canvas>

                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∏–≥—Ä—ã -->
                    <div class="game-message" id="startMessage">
                        <div class="message-title">üöÄ –õ–ï–¢–ò –ù–ê –õ–£–ù–£</div>
                        <div class="message-text">
                            –°–æ–±–µ—Ä–∏ –∑–≤—ë–∑–¥—ã, –∏–∑–±–µ–≥–∞–π –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤<br>–∏ –¥–æ–ª–µ—Ç–∏ –¥–æ –õ—É–Ω—ã!
                        </div>
                        <button class="control-btn start-btn" onclick="startGame()" style="width: 100%;">
                            <i class="fas fa-play"></i> –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
                        </button>
                    </div>

                    <div class="game-message" id="winMessage" style="display: none;">
                        <div class="message-title">üéâ –ü–û–ë–ï–î–ê!</div>
                        <div class="message-text">–¢—ã –¥–æ–±—Ä–∞–ª—Å—è –¥–æ –õ—É–Ω—ã!</div>
                        <div class="message-stats" id="winStats"></div>
                        <button class="control-btn start-btn" onclick="restartGame()" style="width: 100%;">
                            <i class="fas fa-redo"></i> –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê
                        </button>
                    </div>

                    <div class="game-message" id="loseMessage" style="display: none;">
                        <div class="message-title">üí• –ü–†–û–ò–ì–†–´–®</div>
                        <div class="message-text">–†–∞–∫–µ—Ç–∞ —Ä–∞–∑—Ä—É—à–µ–Ω–∞!</div>
                        <div class="message-stats" id="loseStats"></div>
                        <button class="control-btn start-btn" onclick="restartGame()" style="width: 100%;">
                            <i class="fas fa-redo"></i> –ü–û–í–¢–û–†–ò–¢–¨
                        </button>
                    </div>

                    <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                    <div class="mobile-controls">
                        <div class="mobile-btn" id="leftBtn">‚Üê</div>
                        <div class="mobile-btn" id="upBtn">‚Üë</div>
                        <div class="mobile-btn" id="rightBtn">‚Üí</div>
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="game-info">
                    <div class="info-section">
                        <h2 class="info-title"><i class="fas fa-chart-bar"></i> –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h2>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="scoreValue">0</div>
                                <div class="stat-label">‚≠ê –ó–≤—ë–∑–¥ —Å–æ–±—Ä–∞–Ω–æ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="distanceValue">0</div>
                                <div class="stat-label">üåô –î–æ –õ—É–Ω—ã (–∫–º)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="fuelValue">100</div>
                                <div class="stat-label">‚õΩ –¢–æ–ø–ª–∏–≤–æ (%)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="speedValue">0</div>
                                <div class="stat-label">üöÄ –°–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)</div>
                            </div>
                        </div>

                        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ –õ—É–Ω—ã -->
                        <div style="margin-top: 20px;">
                            <div style="display: flex; justify-content: space-between; color: #aaa; margin-bottom: 5px;">
                                <span>üöÄ –ó–µ–º–ª—è</span>
                                <span id="progressText">0%</span>
                                <span>üåô –õ—É–Ω–∞</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h2 class="info-title"><i class="fas fa-gamepad"></i> –£–ü–†–ê–í–õ–ï–ù–ò–ï</h2>
                        <div class="controls-info">
                            <span class="key">W</span> / <span class="key">‚Üë</span> - –í–≤–µ—Ä—Ö
                        </div>
                        <div class="controls-info">
                            <span class="key">A</span> / <span class="key">‚Üê</span> - –í–ª–µ–≤–æ
                        </div>
                        <div class="controls-info">
                            <span class="key">S</span> / <span class="key">‚Üì</span> - –í–Ω–∏–∑
                        </div>
                        <div class="controls-info">
                            <span class="key">D</span> / <span class="key">‚Üí</span> - –í–ø—Ä–∞–≤–æ
                        </div>
                        <div class="controls-info">
                            <span class="key">–ü–†–û–ë–ï–õ</span> - –£—Å–∫–æ—Ä–∏—Ç—å—Å—è
                        </div>
                    </div>

                    <!-- –ü–æ–ª–æ—Å–∫–∞ —Ç–æ–ø–ª–∏–≤–∞ -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; color: #aaa; margin-bottom: 5px;">
                            <span>‚õΩ –¢–æ–ø–ª–∏–≤–æ</span>
                            <span id="fuelText">100%</span>
                        </div>
                        <div class="fuel-bar">
                            <div class="fuel-fill" id="fuelFill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="game-controls">
                <button class="control-btn start-btn" onclick="startGame()" id="startButton">
                    <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                </button>
                <button class="control-btn pause-btn" onclick="togglePause()" id="pauseButton" disabled>
                    <i class="fas fa-pause"></i> –ü–∞—É–∑–∞
                </button>
                <button class="control-btn reset-btn" onclick="restartGame()">
                    <i class="fas fa-redo"></i> –ó–∞–Ω–æ–≤–æ
                </button>
                <button class="control-btn back-btn" onclick="window.location.href='/games'">
                    <i class="fas fa-gamepad"></i> –î—Ä—É–≥–∏–µ –∏–≥—Ä—ã
                </button>
            </div>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let canvas, ctx;
        let gameRunning = false;
        let gamePaused = false;
        let gameLoop;
        let lastTime = 0;

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã
        let stats = {
            score: 0,
            distance: 0,
            fuel: 100,
            speed: 0,
            maxDistance: 384400, // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –õ—É–Ω—ã –≤ –∫–º
            progress: 0,
            starsCollected: 0,
            obstaclesAvoided: 0
        };

        // –û–±—ä–µ–∫—Ç—ã –∏–≥—Ä—ã
        let rocket = {
            x: 400,
            y: 300,
            width: 40,
            height: 60,
            velocityX: 0,
            velocityY: 0,
            rotation: 0,
            thrust: false,
            color: '#ff5500'
        };

        let stars = [];
        let obstacles = [];
        let particles = [];
        let moon = {
            x: 0,
            y: 0,
            radius: 60,
            color: '#cccccc'
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã "–õ–µ—Ç–∏ –Ω–∞ –õ—É–Ω—É"');

            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –õ—É–Ω—É –≤ –∫–æ–Ω—Ü–µ –ø—É—Ç–∏
            moon.x = canvas.width - moon.radius - 50;
            moon.y = canvas.height / 2;

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            resetStats();

            // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–Ω–æ–µ –ø–æ–ª–µ –≤ –∏–≥—Ä–µ
            createStars();
            createObstacles();

            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            setupControls();

            // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥–Ω–æ–µ –ø–æ–ª–µ —Ñ–æ–Ω–∞
            createStarfield();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            showMessage('startMessage');

            console.log('–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        // –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function resetStats() {
            stats = {
                score: 0,
                distance: 0,
                fuel: 100,
                speed: 0,
                maxDistance: 384400,
                progress: 0,
                starsCollected: 0,
                obstaclesAvoided: 0
            };

            rocket = {
                x: canvas ? canvas.width / 2 : 400,
                y: canvas ? canvas.height - 100 : 300,
                width: 40,
                height: 60,
                velocityX: 0,
                velocityY: 0,
                rotation: 0,
                thrust: false,
                color: '#ff5500'
            };

            stars = [];
            obstacles = [];
            particles = [];

            updateUI();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—ë–∑–¥ –¥–ª—è —Å–±–æ—Ä–∞
        function createStars() {
            stars = [];
            const starCount = 15;

            for (let i = 0; i < starCount; i++) {
                stars.push({
                    x: Math.random() * (canvas.width - 100) + 50,
                    y: Math.random() * (canvas.height - 200) + 50,
                    radius: 15,
                    color: '#ffff00',
                    collected: false,
                    pulse: 0,
                    pulseSpeed: Math.random() * 0.05 + 0.02
                });
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π (–º–µ—Ç–µ–æ—Ä–∏—Ç–æ–≤)
        function createObstacles() {
            obstacles = [];
            const obstacleCount = 10;

            for (let i = 0; i < obstacleCount; i++) {
                obstacles.push({
                    x: Math.random() * (canvas.width - 100) + 50,
                    y: Math.random() * (canvas.height - 200) + 50,
                    radius: Math.random() * 20 + 15,
                    color: '#ff4444',
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: Math.random() * 0.02 - 0.01
                });
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function setupControls() {
            // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);

            // –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            const leftBtn = document.getElementById('leftBtn');
            const upBtn = document.getElementById('upBtn');
            const rightBtn = document.getElementById('rightBtn');

            if (leftBtn) {
                leftBtn.addEventListener('touchstart', () => handleMobileKey('left', true));
                leftBtn.addEventListener('touchend', () => handleMobileKey('left', false));
                leftBtn.addEventListener('mousedown', () => handleMobileKey('left', true));
                leftBtn.addEventListener('mouseup', () => handleMobileKey('left', false));
                leftBtn.addEventListener('mouseleave', () => handleMobileKey('left', false));
            }

            if (upBtn) {
                upBtn.addEventListener('touchstart', () => handleMobileKey('up', true));
                upBtn.addEventListener('touchend', () => handleMobileKey('up', false));
                upBtn.addEventListener('mousedown', () => handleMobileKey('up', true));
                upBtn.addEventListener('mouseup', () => handleMobileKey('up', false));
                upBtn.addEventListener('mouseleave', () => handleMobileKey('up', false));
            }

            if (rightBtn) {
                rightBtn.addEventListener('touchstart', () => handleMobileKey('right', true));
                rightBtn.addEventListener('touchend', () => handleMobileKey('right', false));
                rightBtn.addEventListener('mousedown', () => handleMobileKey('right', true));
                rightBtn.addEventListener('mouseup', () => handleMobileKey('right', false));
                rightBtn.addEventListener('mouseleave', () => handleMobileKey('right', false));
            }

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.mobile-btn').forEach(btn => {
                btn.addEventListener('touchstart', (e) => e.preventDefault());
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        const keys = {};

        function handleKeyDown(e) {
            if (!gameRunning || gamePaused) return;

            keys[e.key.toLowerCase()] = true;
            keys[e.code] = true;

            // –ü—Ä–æ–±–µ–ª –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
            if (e.code === 'Space') {
                rocket.thrust = true;
                if (stats.fuel > 0) {
                    stats.speed += 2;
                    stats.fuel -= 0.2;
                }
            }
        }

        function handleKeyUp(e) {
            keys[e.key.toLowerCase()] = false;
            keys[e.code] = false;

            if (e.code === 'Space') {
                rocket.thrust = false;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function handleMobileKey(direction, pressed) {
            if (!gameRunning || gamePaused) return;

            switch(direction) {
                case 'left':
                    keys['arrowleft'] = pressed;
                    keys['a'] = pressed;
                    break;
                case 'right':
                    keys['arrowright'] = pressed;
                    keys['d'] = pressed;
                    break;
                case 'up':
                    keys['arrowup'] = pressed;
                    keys['w'] = pressed;
                    break;
            }
        }

        // –ì–ª–∞–≤–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameUpdate(currentTime) {
            if (!gameRunning || gamePaused) return;

            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–∑–∏–∫–∏
            updatePhysics(deltaTime);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
            checkCollisions();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π
            updateAnimations(deltaTime);

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            draw();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateUI();

            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ü–∏–∫–ª
            gameLoop = requestAnimationFrame(gameUpdate);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–∑–∏–∫–∏
        function updatePhysics(deltaTime) {
            const dt = deltaTime / 16; // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∫–µ—Ç–æ–π
            rocket.velocityX = 0;
            rocket.velocityY = 0;

            if (keys['arrowleft'] || keys['a']) {
                rocket.velocityX = -5 * dt;
                rocket.rotation = -0.2;
            }
            if (keys['arrowright'] || keys['d']) {
                rocket.velocityX = 5 * dt;
                rocket.rotation = 0.2;
            }
            if (keys['arrowup'] || keys['w']) {
                rocket.velocityY = -5 * dt;
                if (stats.fuel > 0) {
                    stats.speed += 0.1 * dt;
                    stats.fuel -= 0.1 * dt;
                }
            }
            if (keys['arrowdown'] || keys['s']) {
                rocket.velocityY = 5 * dt;
                rocket.rotation = 0;
            }

            // –ï—Å–ª–∏ –Ω–µ –Ω–∞–∂–∞—Ç—ã –∫–ª–∞–≤–∏—à–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
            if (!keys['arrowleft'] && !keys['arrowright'] && !keys['a'] && !keys['d']) {
                rocket.rotation *= 0.9;
            }

            // –î–≤–∏–∂–µ–Ω–∏–µ —Ä–∞–∫–µ—Ç—ã
            rocket.x += rocket.velocityX;
            rocket.y += rocket.velocityY;

            // –ì—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
            rocket.x = Math.max(rocket.width / 2, Math.min(canvas.width - rocket.width / 2, rocket.x));
            rocket.y = Math.max(rocket.height / 2, Math.min(canvas.height - rocket.height / 2, rocket.y));

            // –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
            stats.speed *= 0.99;

            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
            stats.distance += stats.speed * dt;
            stats.progress = Math.min(100, (stats.distance / stats.maxDistance) * 100);

            // –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ç–æ–ø–ª–∏–≤–∞
            if (stats.fuel > 0 && (rocket.thrust || keys['arrowup'] || keys['w'])) {
                stats.fuel = Math.max(0, stats.fuel - 0.1 * dt);
            }

            // –ï—Å–ª–∏ —Ç–æ–ø–ª–∏–≤–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
            if (stats.fuel <= 0) {
                stats.speed *= 0.95;
            }

            // –ü—É–ª—å—Å–∞—Ü–∏—è –∑–≤—ë–∑–¥
            stars.forEach(star => {
                if (!star.collected) {
                    star.pulse += star.pulseSpeed * dt;
                }
            });

            // –í—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
            obstacles.forEach(obstacle => {
                obstacle.rotation += obstacle.rotationSpeed * dt;
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].x += particles[i].velocityX;
                particles[i].y += particles[i].velocityY;
                particles[i].life -= 0.02 * dt;

                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                }
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –≤—ã—Ö–ª–æ–ø–∞
            if (rocket.thrust && stats.fuel > 0 && gameRunning) {
                createExhaustParticles();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        function checkCollisions() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞ –∑–≤—ë–∑–¥
            stars.forEach(star => {
                if (!star.collected) {
                    const dx = rocket.x - star.x;
                    const dy = rocket.y - star.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < rocket.width / 2 + star.radius) {
                        star.collected = true;
                        stats.score += 10;
                        stats.starsCollected++;

                        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–±–æ—Ä–∞
                        createStarCollectionAnimation(star.x, star.y);

                        // –ó–≤—É–∫ —Å–±–æ—Ä–∞
                        playSound('star');

                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ø–ª–∏–≤–∞ –∑–∞ —Å–±–æ—Ä –∑–≤–µ–∑–¥—ã
                        stats.fuel = Math.min(100, stats.fuel + 5);
                    }
                }
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏
            obstacles.forEach(obstacle => {
                const dx = rocket.x - obstacle.x;
                const dy = rocket.y - obstacle.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < rocket.width / 2 + obstacle.radius) {
                    // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ!
                    gameOver();
                }
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –õ—É–Ω—ã
            const dx = rocket.x - moon.x;
            const dy = rocket.y - moon.y;
            const distanceToMoon = Math.sqrt(dx * dx + dy * dy);

            if (distanceToMoon < rocket.width / 2 + moon.radius) {
                winGame();
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ —Ç–æ–ø–ª–∏–≤–∞ –≤ –∫–æ—Å–º–æ—Å–µ
            if (stats.fuel <= 0 && stats.distance < stats.maxDistance * 0.8) {
                // –ï—Å–ª–∏ —Ç–æ–ø–ª–∏–≤–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å —Ä–∞–Ω–æ
                stats.speed = 0;
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–±–æ—Ä–∞ –∑–≤–µ–∑–¥—ã
        function createStarCollectionAnimation(x, y) {
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x: x,
                    y: y,
                    velocityX: (Math.random() - 0.5) * 4,
                    velocityY: (Math.random() - 0.5) * 4,
                    radius: Math.random() * 3 + 1,
                    color: '#ffff00',
                    life: 1
                });
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è CSS –∞–Ω–∏–º–∞—Ü–∏–∏
            const starAnim = document.createElement('div');
            starAnim.className = 'star-animation';
            starAnim.innerHTML = '‚≠ê';
            starAnim.style.cssText = `
                position: absolute;
                left: ${x}px;
                top: ${y}px;
                font-size: 2rem;
            `;
            document.querySelector('.game-area').appendChild(starAnim);

            setTimeout(() => {
                starAnim.remove();
            }, 500);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –≤—ã—Ö–ª–æ–ø–∞
        function createExhaustParticles() {
            const angle = rocket.rotation;
            const exhaustX = rocket.x - Math.sin(angle) * rocket.height / 2;
            const exhaustY = rocket.y + Math.cos(angle) * rocket.height / 2;

            for (let i = 0; i < 3; i++) {
                particles.push({
                    x: exhaustX,
                    y: exhaustY,
                    velocityX: (Math.random() - 0.5) * 2 - Math.sin(angle) * 2,
                    velocityY: (Math.random() - 0.5) * 2 + Math.cos(angle) * 2,
                    radius: Math.random() * 3 + 2,
                    color: '#ff5500',
                    life: 0.5
                });
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–π
        function updateAnimations(deltaTime) {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
        function draw() {
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // –§–æ–Ω
            drawBackground();

            // –õ—É–Ω–∞
            drawMoon();

            // –ó–≤—ë–∑–¥—ã
            drawStars();

            // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            drawObstacles();

            // –ß–∞—Å—Ç–∏—Ü—ã
            drawParticles();

            // –†–∞–∫–µ—Ç–∞
            drawRocket();

            // –û–≤–µ—Ä–ª–µ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            drawOverlay();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞
        function drawBackground() {
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0a0a2a');
            gradient.addColorStop(0.5, '#1a1a4a');
            gradient.addColorStop(1, '#0a0a2a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –î–∞–ª–µ–∫–∏–µ –∑–≤–µ–∑–¥—ã
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            for (let i = 0; i < 50; i++) {
                const x = (i * 37) % canvas.width;
                const y = (i * 23) % canvas.height;
                const size = Math.sin(Date.now() * 0.001 + i) * 1 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –õ—É–Ω—ã
        function drawMoon() {
            // –¢–µ–Ω—å –õ—É–Ω—ã
            ctx.beginPath();
            ctx.arc(moon.x, moon.y, moon.radius + 5, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fill();

            // –õ—É–Ω–∞
            ctx.beginPath();
            ctx.arc(moon.x, moon.y, moon.radius, 0, Math.PI * 2);

            // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –õ—É–Ω—ã
            const moonGradient = ctx.createRadialGradient(
                moon.x - 20, moon.y - 20, 10,
                moon.x, moon.y, moon.radius
            );
            moonGradient.addColorStop(0, '#ffffff');
            moonGradient.addColorStop(1, '#aaaaaa');
            ctx.fillStyle = moonGradient;
            ctx.fill();

            // –ö—Ä–∞—Ç–µ—Ä—ã –Ω–∞ –õ—É–Ω–µ
            ctx.fillStyle = '#888888';
            ctx.beginPath();
            ctx.arc(moon.x - 20, moon.y - 10, 8, 0, Math.PI * 2);
            ctx.fill();

            ctx.beginPath();
            ctx.arc(moon.x + 15, moon.y + 10, 6, 0, Math.PI * 2);
            ctx.fill();

            ctx.beginPath();
            ctx.arc(moon.x + 5, moon.y + 25, 4, 0, Math.PI * 2);
            ctx.fill();

            // –¢–µ–∫—Å—Ç "–õ–£–ù–ê"
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üåô –õ–£–ù–ê', moon.x, moon.y + moon.radius + 25);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–≤—ë–∑–¥
        function drawStars() {
            stars.forEach(star => {
                if (!star.collected) {
                    // –ü—É–ª—å—Å–∞—Ü–∏—è
                    const pulseRadius = star.radius + Math.sin(star.pulse) * 3;

                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∑–≤–µ–∑–¥—ã
                    const gradient = ctx.createRadialGradient(
                        star.x, star.y, 0,
                        star.x, star.y, pulseRadius
                    );
                    gradient.addColorStop(0, '#ffff00');
                    gradient.addColorStop(1, '#ffaa00');

                    ctx.beginPath();
                    ctx.arc(star.x, star.y, pulseRadius, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();

                    // –ë–ª–µ—Å–∫
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, pulseRadius * 0.5, 0, Math.PI * 2);
                    ctx.fillStyle = '#ffffff';
                    ctx.fill();

                    // –≠–º–æ–¥–∑–∏ –∑–≤–µ–∑–¥—ã –ø–æ–≤–µ—Ä—Ö
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('‚≠ê', star.x, star.y);
                }
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.save();
                ctx.translate(obstacle.x, obstacle.y);
                ctx.rotate(obstacle.rotation);

                // –ú–µ—Ç–µ–æ—Ä–∏—Ç
                ctx.beginPath();
                ctx.arc(0, 0, obstacle.radius, 0, Math.PI * 2);

                const gradient = ctx.createRadialGradient(
                    -10, -10, 5,
                    0, 0, obstacle.radius
                );
                gradient.addColorStop(0, '#ff6666');
                gradient.addColorStop(1, '#aa0000');
                ctx.fillStyle = gradient;
                ctx.fill();

                // –î–µ—Ç–∞–ª–∏ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
                ctx.fillStyle = '#884444';
                ctx.beginPath();
                ctx.arc(-5, -5, 3, 0, Math.PI * 2);
                ctx.fill();

                ctx.beginPath();
                ctx.arc(8, 5, 4, 0, Math.PI * 2);
                ctx.fill();

                ctx.beginPath();
                ctx.arc(0, 10, 2, 0, Math.PI * 2);
                ctx.fill();

                // –≠–º–æ–¥–∑–∏ –º–µ—Ç–µ–æ—Ä–∏—Ç–∞
                ctx.font = 'bold 24px Arial';
                ctx.fillText('‚òÑÔ∏è', 0, 0);

                ctx.restore();
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü
        function drawParticles() {
            particles.forEach(particle => {
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                ctx.fillStyle = particle.color;
                ctx.globalAlpha = particle.life;
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–∞–∫–µ—Ç—ã
        function drawRocket() {
            ctx.save();
            ctx.translate(rocket.x, rocket.y);
            ctx.rotate(rocket.rotation);

            // –ö–æ—Ä–ø—É—Å —Ä–∞–∫–µ—Ç—ã
            ctx.fillStyle = rocket.color;
            ctx.fillRect(-rocket.width / 2, -rocket.height / 2, rocket.width, rocket.height);

            // –ù–æ—Å —Ä–∞–∫–µ—Ç—ã
            ctx.beginPath();
            ctx.moveTo(-rocket.width / 2, -rocket.height / 2);
            ctx.lineTo(rocket.width / 2, -rocket.height / 2);
            ctx.lineTo(0, -rocket.height / 2 - 20);
            ctx.closePath();
            ctx.fillStyle = '#ff8800';
            ctx.fill();

            // –û–∫–Ω–∞
            ctx.fillStyle = '#00ffff';
            ctx.beginPath();
            ctx.arc(0, 0, 8, 0, Math.PI * 2);
            ctx.fill();

            // –ö—Ä—ã–ª—å—è
            ctx.fillStyle = '#ff3300';
            ctx.fillRect(-rocket.width / 2 - 5, rocket.height / 2 - 20, 10, 20);
            ctx.fillRect(rocket.width / 2 - 5, rocket.height / 2 - 20, 10, 20);

            // –î–≤–∏–≥–∞—Ç–µ–ª—å (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç—è–≥–∞)
            if (rocket.thrust && stats.fuel > 0) {
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                ctx.moveTo(-10, rocket.height / 2);
                ctx.lineTo(10, rocket.height / 2);
                ctx.lineTo(0, rocket.height / 2 + 30);
                ctx.closePath();
                ctx.fill();
            }

            // –≠–º–æ–¥–∑–∏ —Ä–∞–∫–µ—Ç—ã –ø–æ–≤–µ—Ä—Ö
            ctx.font = 'bold 30px Arial';
            ctx.fillText('üöÄ', 0, 0);

            ctx.restore();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–≤–µ—Ä–ª–µ—è
        function drawOverlay() {
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã HUD –ø–æ–≤–µ—Ä—Ö –∏–≥—Ä—ã
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            document.getElementById('scoreValue').textContent = stats.score;
            document.getElementById('distanceValue').textContent = Math.floor(stats.distance);
            document.getElementById('fuelValue').textContent = Math.floor(stats.fuel);
            document.getElementById('speedValue').textContent = Math.floor(stats.speed * 1000);
            document.getElementById('progressText').textContent = Math.floor(stats.progress) + '%';
            document.getElementById('fuelText').textContent = Math.floor(stats.fuel) + '%';

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            document.getElementById('progressFill').style.width = stats.progress + '%';

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–æ—Å–∫–∏ —Ç–æ–ø–ª–∏–≤–∞
            document.getElementById('fuelFill').style.width = stats.fuel + '%';

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Ç–æ–ø–ª–∏–≤–∞
            const fuelFill = document.getElementById('fuelFill');
            if (stats.fuel > 50) {
                fuelFill.style.background = 'linear-gradient(90deg, #ff5500, #ffff00)';
            } else if (stats.fuel > 20) {
                fuelFill.style.background = 'linear-gradient(90deg, #ffaa00, #ffff00)';
            } else {
                fuelFill.style.background = 'linear-gradient(90deg, #ff0000, #ffaa00)';
            }
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            if (gameRunning) return;

            gameRunning = true;
            gamePaused = false;
            lastTime = performance.now();

            hideAllMessages();

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø–∞—É–∑—ã
            document.getElementById('pauseButton').disabled = false;
            document.getElementById('startButton').disabled = true;

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameLoop = requestAnimationFrame(gameUpdate);

            console.log('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å');
        }

        // –ü–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
        function togglePause() {
            if (!gameRunning) return;

            gamePaused = !gamePaused;

            const pauseButton = document.getElementById('pauseButton');
            if (gamePaused) {
                pauseButton.innerHTML = '<i class="fas fa-play"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                showNotification('‚è∏Ô∏è –ò–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ');
            } else {
                pauseButton.innerHTML = '<i class="fas fa-pause"></i> –ü–∞—É–∑–∞';
                lastTime = performance.now();
                gameLoop = requestAnimationFrame(gameUpdate);
                showNotification('‚ñ∂Ô∏è –ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è');
            }
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        function restartGame() {
            cancelAnimationFrame(gameLoop);
            gameRunning = false;
            gamePaused = false;

            resetStats();
            createStars();
            createObstacles();

            document.getElementById('pauseButton').disabled = true;
            document.getElementById('startButton').disabled = false;
            document.getElementById('pauseButton').innerHTML = '<i class="fas fa-pause"></i> –ü–∞—É–∑–∞';

            showMessage('startMessage');

            console.log('–ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞');
        }

        // –ü–æ–±–µ–¥–∞ –≤ –∏–≥—Ä–µ
        async function winGame() {
            if (!gameRunning) return;

            gameRunning = false;
            cancelAnimationFrame(gameLoop);

            // –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã
            const baseStars = 10;
            const speedBonus = Math.floor(stats.speed * 2);
            const starBonus = stats.starsCollected * 5;
            const fuelBonus = Math.floor(stats.fuel / 10);
            const totalStars = baseStars + speedBonus + starBonus + fuelBonus;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ
            document.getElementById('winStats').innerHTML = `
                ‚≠ê –°–æ–±—Ä–∞–Ω–æ –∑–≤—ë–∑–¥: ${stats.starsCollected}<br>
                üöÄ –ú–∞–∫—Å. —Å–∫–æ—Ä–æ—Å—Ç—å: ${Math.floor(stats.speed * 1000)} –∫–º/—á<br>
                ‚õΩ –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ø–ª–∏–≤–∞: ${Math.floor(stats.fuel)}%<br>
                üéØ –û–±—â–∏–π —Å—á—ë—Ç: ${stats.score}<br>
                <br>
                <span style="color: gold; font-size: 1.3rem;">
                    üéÅ –ù–∞–≥—Ä–∞–¥–∞: +${totalStars} –∑–≤—ë–∑–¥!
                </span>
            `;
            showMessage('winMessage');

            // –ù–∞—á–∏—Å–ª—è–µ–º –∑–≤—ë–∑–¥—ã
            try {
                const response = await fetch('/add_star', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        count: totalStars,
                        reason: '–î–æ–ª–µ—Ç–µ–ª –¥–æ –õ—É–Ω—ã –≤ –∏–≥—Ä–µ'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showNotification(`‚≠ê –ü–æ–ª—É—á–µ–Ω–æ ${totalStars} –∑–≤—ë–∑–¥! –í—Å–µ–≥–æ: ${data.stars}`);
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–≤—ë–∑–¥:', error);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ
            updateUserProfile();

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø–æ–±–µ–¥—ã
            playSound('success');
        }

        // –ü—Ä–æ–∏–≥—Ä—ã—à
        async function gameOver() {
            if (!gameRunning) return;

            gameRunning = false;
            cancelAnimationFrame(gameLoop);

            // –í–∑—Ä—ã–≤ —Ä–∞–∫–µ—Ç—ã
            createExplosion();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
            document.getElementById('loseStats').innerHTML = `
                ‚≠ê –°–æ–±—Ä–∞–Ω–æ –∑–≤—ë–∑–¥: ${stats.starsCollected}<br>
                üåô –ü—Ä–æ–π–¥–µ–Ω–æ: ${Math.floor(stats.progress)}% –ø—É—Ç–∏<br>
                üöÄ –ú–∞–∫—Å. —Å–∫–æ—Ä–æ—Å—Ç—å: ${Math.floor(stats.speed * 1000)} –∫–º/—á<br>
                üéØ –û–±—â–∏–π —Å—á—ë—Ç: ${stats.score}<br>
                <br>
                <span style="color: #ff4444;">
                    üí• –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –º–µ—Ç–µ–æ—Ä–∏—Ç–æ–º!
                </span>
            `;
            showMessage('loseMessage');

            // –ù–∞—á–∏—Å–ª—è–µ–º –∑–≤—ë–∑–¥—ã –∑–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∑–≤–µ–∑–¥—ã
            if (stats.starsCollected > 0) {
                const starReward = stats.starsCollected;
                try {
                    const response = await fetch('/add_star', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            count: starReward,
                            reason: '–°–æ–±—Ä–∞–ª –∑–≤—ë–∑–¥—ã –≤ –∏–≥—Ä–µ "–õ–µ—Ç–∏ –Ω–∞ –õ—É–Ω—É"'
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        showNotification(`‚≠ê –ü–æ–ª—É—á–µ–Ω–æ ${starReward} –∑–≤—ë–∑–¥ –∑–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∑–≤–µ–∑–¥—ã!`);
                    }
                } catch (error) {
                    console.log('–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–≤—ë–∑–¥:', error);
                }
            }

            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –≤–∑—Ä—ã–≤–∞
            playSound('error');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∑—Ä—ã–≤–∞
        function createExplosion() {
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: rocket.x,
                    y: rocket.y,
                    velocityX: (Math.random() - 0.5) * 10,
                    velocityY: (Math.random() - 0.5) * 10,
                    radius: Math.random() * 4 + 2,
                    color: ['#ff0000', '#ff5500', '#ffff00'][Math.floor(Math.random() * 3)],
                    life: 1
                });
            }

            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–¥—Ä —Å –≤–∑—Ä—ã–≤–æ–º
            draw();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function updateUserProfile() {
            try {
                await fetch('/update_profile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        games_played: 'increment'
                    })
                });
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error);
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        function showMessage(messageId) {
            hideAllMessages();
            document.getElementById(messageId).style.display = 'block';
        }

        function hideAllMessages() {
            document.getElementById('startMessage').style.display = 'none';
            document.getElementById('winMessage').style.display = 'none';
            document.getElementById('loseMessage').style.display = 'none';
        }

        // –ó–≤—É–∫–∏
        function playSound(type) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—ã–ª–∏ –±—ã –∑–≤—É–∫–æ–≤—ã–µ —Ñ–∞–π–ª—ã
            console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞:', type);
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 15px 25px;
                border-radius: 15px;
                border-left: 5px solid gold;
                max-width: 300px;
                z-index: 10000;
                animation: slideIn 0.3s;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤–µ–∑–¥–Ω–æ–≥–æ –ø–æ–ª—è
        function createStarfield() {
            const starfield = document.querySelector('.starfield');
            starfield.innerHTML = '';

            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.cssText = `
                    position: absolute;
                    width: ${Math.random() * 3 + 1}px;
                    height: ${Math.random() * 3 + 1}px;
                    background: white;
                    border-radius: 50%;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation: twinkle ${Math.random() * 3 + 2}s infinite;
                    animation-delay: ${Math.random() * 3}s;
                `;
                starfield.appendChild(star);
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        function addGameStyles() {
            if (!document.getElementById('fly-game-styles')) {
                const style = document.createElement('style');
                style.id = 'fly-game-styles';
                style.textContent = `
                    @keyframes collectStar {
                        0% {
                            transform: scale(1) translateY(0);
                            opacity: 1;
                        }
                        100% {
                            transform: scale(0) translateY(-50px);
                            opacity: 0;
                        }
                    }

                    @keyframes slideIn {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }

                    @keyframes pulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.7; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        function handleResize() {
            if (canvas) {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;

                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –õ—É–Ω—É
                moon.x = canvas.width - moon.radius - 50;
                moon.y = canvas.height / 2;

                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º, –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
                if (!gameRunning) {
                    draw();
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–≥—Ä—ã "–õ–µ—Ç–∏ –Ω–∞ –õ—É–Ω—É" –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            addGameStyles();
            initGame();

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', handleResize);
        });
    </script>

</body>
</html>